<%= form_with(model: technician, local: true, class: "needs-validation", novalidate: true) do |f| %>
  <% if technician.errors.any? %>
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
      <h4 class="alert-heading">
        <i class="fas fa-exclamation-triangle"></i>
        <%= pluralize(technician.errors.count, "erro") %> impediram que o técnico fosse salvo:
      </h4>
      <ul class="mb-0">
        <% technician.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
  <% end %>

  <div class="row">
    <!-- Dados Básicos -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-user"></i> Dados Básicos</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <%= f.label :name, "Nome *", class: "form-label" %>
            <%= f.text_field :name, class: "form-control", required: true, placeholder: "Ex: João Silva" %>
            <div class="invalid-feedback">
              Por favor, informe o nome do técnico.
            </div>
          </div>

          <div class="mb-3">
            <%= f.label :email, "Email", class: "form-label" %>
            <%= f.email_field :email, class: "form-control", placeholder: "Ex: joao@exemplo.com" %>
            <small class="form-text text-muted">Email opcional para contato</small>
          </div>

          <div class="mb-3">
            <%= f.label :phone, "Telefone", class: "form-label" %>
            <%= f.text_field :phone, class: "form-control", placeholder: "Ex: (11) 98765-4321" %>
            <small class="form-text text-muted">Telefone de contato</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Especialidade e Status -->
    <div class="col-md-6">
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-cogs"></i> Especialidade</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <%= f.label :specialty, "Especialidade", class: "form-label" %>
            <%= f.select :specialty, 
                options_for_select([['Selecione uma especialidade', '']] + Technician::SPECIALTIES.map { |s| [s, s] }, technician.specialty),
                {}, 
                class: "form-select" %>
            <small class="form-text text-muted">Área de atuação principal</small>
          </div>

          <div class="mb-3">
            <%= f.label :user_id, "Usuário do Sistema", class: "form-label" %>
            <%= f.collection_select :user_id, 
                User.all.order(:name), 
                :id, 
                :name,
                { prompt: "Nenhum (técnico externo)" },
                class: "form-select" %>
            <small class="form-text text-muted">Vincular a um usuário do sistema (opcional)</small>
          </div>

          <div class="mb-3">
            <div class="form-check form-switch">
              <%= f.check_box :active, class: "form-check-input" %>
              <%= f.label :active, "Técnico Ativo", class: "form-check-label" %>
            </div>
            <small class="form-text text-muted">Técnicos inativos não aparecem na seleção de ordens</small>
          </div>
        </div>
      </div>
    </div>

    <!-- Observações -->
    <div class="col-12">
      <div class="card mb-3">
        <div class="card-header">
          <h5 class="mb-0"><i class="fas fa-sticky-note"></i> Observações</h5>
        </div>
        <div class="card-body">
          <div class="mb-3">
            <%= f.label :notes, "Notas / Observações", class: "form-label" %>
            <%= f.text_area :notes, class: "form-control", rows: 4, placeholder: "Informações adicionais sobre o técnico..." %>
            <small class="form-text text-muted">Qualificações, certificações, horário de trabalho, etc.</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="d-flex gap-2">
    <%= f.submit class: "btn btn-primary" do %>
      <i class="fas fa-save"></i> <%= technician.new_record? ? 'Cadastrar Técnico' : 'Atualizar Técnico' %>
    <% end %>
    <%= link_to technicians_path, class: "btn btn-secondary" do %>
      <i class="fas fa-times"></i> Cancelar
    <% end %>
  </div>
<% end %>

<script>
  // Bootstrap form validation
  (function() {
    'use strict';
    var forms = document.querySelectorAll('.needs-validation');
    Array.prototype.slice.call(forms).forEach(function(form) {
      form.addEventListener('submit', function(event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();
</script>
