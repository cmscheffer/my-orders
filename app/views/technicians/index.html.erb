<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1><i class="fas fa-user-cog"></i> Técnicos</h1>
    <%= link_to new_technician_path, class: "btn btn-primary" do %>
      <i class="fas fa-plus"></i> Novo Técnico
    <% end %>
  </div>

  <!-- Filtros -->
  <div class="card mb-4">
    <div class="card-body">
      <%= form_with url: technicians_path, method: :get, local: true, class: "row g-3" do |f| %>
        <div class="col-md-4">
          <%= f.text_field :search, 
              value: params[:search],
              class: "form-control", 
              placeholder: "Buscar por nome ou email..." %>
        </div>

        <div class="col-md-3">
          <%= f.select :specialty, 
              options_for_select([['Todas as especialidades', '']] + Technician::SPECIALTIES.map { |s| [s, s] }, params[:specialty]),
              {}, 
              class: "form-select" %>
        </div>

        <div class="col-md-3">
          <%= f.select :status,
              options_for_select([
                ['Todos os status', ''],
                ['Ativos', 'active'],
                ['Inativos', 'inactive']
              ], params[:status]),
              {},
              class: "form-select" %>
        </div>

        <div class="col-md-2">
          <%= f.submit "Filtrar", class: "btn btn-primary w-100" %>
        </div>
      <% end %>
    </div>
  </div>

  <!-- Contadores -->
  <div class="row mb-4">
    <div class="col-md-4">
      <div class="card text-white bg-success">
        <div class="card-body">
          <h5 class="card-title"><i class="fas fa-check-circle"></i> Ativos</h5>
          <h2 class="card-text"><%= Technician.active.count %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-secondary">
        <div class="card-body">
          <h5 class="card-title"><i class="fas fa-ban"></i> Inativos</h5>
          <h2 class="card-text"><%= Technician.inactive.count %></h2>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="card text-white bg-primary">
        <div class="card-body">
          <h5 class="card-title"><i class="fas fa-users"></i> Total</h5>
          <h2 class="card-text"><%= Technician.count %></h2>
        </div>
      </div>
    </div>
  </div>

  <!-- Tabela de técnicos -->
  <% if @technicians.any? %>
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>Nome</th>
                <th>Email</th>
                <th>Telefone</th>
                <th>Especialidade</th>
                <th>Ordens</th>
                <th>Status</th>
                <th width="200">Ações</th>
              </tr>
            </thead>
            <tbody>
              <% @technicians.each do |technician| %>
                <tr>
                  <td>
                    <strong><%= technician.name %></strong>
                  </td>
                  <td>
                    <% if technician.email.present? %>
                      <i class="fas fa-envelope"></i> <%= technician.email %>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% if technician.phone.present? %>
                      <i class="fas fa-phone"></i> <%= technician.formatted_phone %>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <% if technician.specialty.present? %>
                      <span class="badge bg-info"><%= technician.specialty %></span>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <span class="badge bg-primary"><%= technician.orders_count %></span>
                    <% if technician.orders_in_progress_count > 0 %>
                      <span class="badge bg-warning"><%= technician.orders_in_progress_count %> em andamento</span>
                    <% end %>
                  </td>
                  <td>
                    <span class="badge <%= technician.status_badge_class %>">
                      <%= technician.status_text %>
                    </span>
                  </td>
                  <td>
                    <%= link_to technician, class: "btn btn-sm btn-info" do %>
                      <i class="fas fa-eye"></i>
                    <% end %>
                    <%= link_to edit_technician_path(technician), class: "btn btn-sm btn-warning" do %>
                      <i class="fas fa-edit"></i>
                    <% end %>
                    <%= button_to toggle_active_technician_path(technician), 
                        method: :patch,
                        class: "btn btn-sm #{technician.active? ? 'btn-secondary' : 'btn-success'}",
                        data: { confirm: "Tem certeza que deseja #{technician.active? ? 'desativar' : 'ativar'} este técnico?" } do %>
                      <i class="fas fa-power-off"></i>
                    <% end %>
                    <%= button_to technician, 
                        method: :delete,
                        class: "btn btn-sm btn-danger",
                        data: { confirm: "Tem certeza que deseja excluir este técnico?" } do %>
                      <i class="fas fa-trash"></i>
                    <% end %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  <% else %>
    <div class="alert alert-info">
      <i class="fas fa-info-circle"></i> Nenhum técnico encontrado com os filtros selecionados.
    </div>
  <% end %>
</div>
