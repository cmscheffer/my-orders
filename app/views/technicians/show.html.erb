<div class="container mt-4">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <div class="d-flex align-items-center">
      <%= link_to technicians_path, class: "btn btn-outline-secondary me-3" do %>
        <i class="fas fa-arrow-left"></i>
      <% end %>
      <h1 class="mb-0">
        <i class="fas fa-user-cog"></i> <%= @technician.name %>
        <span class="badge <%= @technician.status_badge_class %> ms-2">
          <%= @technician.status_text %>
        </span>
      </h1>
    </div>
    <div>
      <%= link_to edit_technician_path(@technician), class: "btn btn-warning" do %>
        <i class="fas fa-edit"></i> Editar
      <% end %>
      <%= button_to toggle_active_technician_path(@technician), 
          method: :patch,
          class: "btn #{@technician.active? ? 'btn-secondary' : 'btn-success'}",
          data: { confirm: "Tem certeza que deseja #{@technician.active? ? 'desativar' : 'ativar'} este técnico?" } do %>
        <i class="fas fa-power-off"></i> <%= @technician.active? ? 'Desativar' : 'Ativar' %>
      <% end %>
    </div>
  </div>

  <div class="row">
    <!-- Informações do Técnico -->
    <div class="col-md-4">
      <div class="card mb-3">
        <div class="card-header bg-primary text-white">
          <h5 class="mb-0"><i class="fas fa-id-card"></i> Informações</h5>
        </div>
        <div class="card-body">
          <p class="mb-2">
            <strong><i class="fas fa-user"></i> Nome:</strong><br>
            <%= @technician.name %>
          </p>

          <% if @technician.email.present? %>
            <p class="mb-2">
              <strong><i class="fas fa-envelope"></i> Email:</strong><br>
              <a href="mailto:<%= @technician.email %>"><%= @technician.email %></a>
            </p>
          <% end %>

          <% if @technician.phone.present? %>
            <p class="mb-2">
              <strong><i class="fas fa-phone"></i> Telefone:</strong><br>
              <a href="tel:<%= @technician.phone %>"><%= @technician.formatted_phone %></a>
            </p>
          <% end %>

          <% if @technician.specialty.present? %>
            <p class="mb-2">
              <strong><i class="fas fa-wrench"></i> Especialidade:</strong><br>
              <span class="badge bg-info"><%= @technician.specialty %></span>
            </p>
          <% end %>

          <% if @technician.user.present? %>
            <p class="mb-2">
              <strong><i class="fas fa-user-circle"></i> Usuário do Sistema:</strong><br>
              <%= @technician.user.name %>
            </p>
          <% end %>

          <p class="mb-0">
            <strong><i class="fas fa-calendar"></i> Cadastrado em:</strong><br>
            <%= l(@technician.created_at, format: :long) %>
          </p>
        </div>
      </div>

      <!-- Observações -->
      <% if @technician.notes.present? %>
        <div class="card mb-3">
          <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-sticky-note"></i> Observações</h5>
          </div>
          <div class="card-body">
            <%= simple_format(@technician.notes) %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Estatísticas e Ordens -->
    <div class="col-md-8">
      <!-- Cards de Estatísticas -->
      <div class="row mb-4">
        <div class="col-md-4">
          <div class="card text-white bg-primary">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @technician.orders_count %></h3>
              <p class="mb-0">Total de Ordens</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-warning">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @technician.orders_in_progress_count %></h3>
              <p class="mb-0">Em Andamento</p>
            </div>
          </div>
        </div>
        <div class="col-md-4">
          <div class="card text-white bg-success">
            <div class="card-body text-center">
              <h3 class="mb-0"><%= @technician.service_orders.where(status: :completed).count %></h3>
              <p class="mb-0">Concluídas</p>
            </div>
          </div>
        </div>
      </div>

      <!-- Ordens de Serviço Recentes -->
      <div class="card">
        <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
          <h5 class="mb-0"><i class="fas fa-list"></i> Ordens de Serviço Recentes</h5>
          <% if @technician.orders_count > 10 %>
            <span class="badge bg-light text-dark">Mostrando últimas 10 de <%= @technician.orders_count %></span>
          <% end %>
        </div>
        <div class="card-body">
          <% if @service_orders.any? %>
            <div class="table-responsive">
              <table class="table table-hover">
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Título</th>
                    <th>Cliente</th>
                    <th>Status</th>
                    <th>Criada em</th>
                    <th>Ações</th>
                  </tr>
                </thead>
                <tbody>
                  <% @service_orders.each do |order| %>
                    <tr>
                      <td><strong>#<%= order.id %></strong></td>
                      <td><%= order.title %></td>
                      <td><%= order.customer_name %></td>
                      <td>
                        <span class="badge <%= order.status_badge_class %>">
                          <%= t("activerecord.attributes.service_order.statuses.#{order.status}") %>
                        </span>
                      </td>
                      <td><%= l(order.created_at, format: :short) %></td>
                      <td>
                        <%= link_to order, class: "btn btn-sm btn-info" do %>
                          <i class="fas fa-eye"></i>
                        <% end %>
                      </td>
                    </tr>
                  <% end %>
                </tbody>
              </table>
            </div>
          <% else %>
            <div class="alert alert-info mb-0">
              <i class="fas fa-info-circle"></i> Este técnico ainda não possui ordens de serviço.
            </div>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
