<div class="row mb-4">
  <div class="col">
    <h1 class="display-4">Cadastro de Peças</h1>
  </div>
  <div class="col text-end">
    <%= link_to "Nova Peça", new_part_path, class: "btn btn-primary btn-lg" %>
  </div>
</div>

<% if @low_stock_parts > 0 %>
  <div class="alert alert-warning alert-dismissible fade show" role="alert">
    <strong><i class="fas fa-exclamation-triangle"></i> Atenção!</strong>
    Existem <%= @low_stock_parts %> peça(s) com estoque baixo.
    <%= link_to "Ver peças", parts_path(active: true), class: "alert-link" %>
    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
  </div>
<% end %>

<div class="card mb-4">
  <div class="card-body">
    <h5 class="card-title">Filtros</h5>
    <%= form_with url: parts_path, method: :get, local: true, class: "row g-3" do |f| %>
      <div class="col-md-3">
        <%= f.label :search, "Buscar", class: "form-label" %>
        <%= f.text_field :search, value: params[:search], class: "form-control", placeholder: "Nome, código ou descrição" %>
      </div>
      
      <div class="col-md-3">
        <%= f.label :category, "Categoria", class: "form-label" %>
        <%= f.select :category,
                     options_for_select([
                       'Componentes Eletrônicos',
                       'Hardware',
                       'Periféricos',
                       'Acessórios',
                       'Consumíveis',
                       'Ferramentas'
                     ], params[:category]),
                     { include_blank: "Todas" },
                     class: "form-select" %>
      </div>
      
      <div class="col-md-3">
        <%= f.label :active, "Status", class: "form-label" %>
        <%= f.select :active,
                     options_for_select([['Ativas', 'true'], ['Inativas', 'false']], params[:active]),
                     { include_blank: "Todos" },
                     class: "form-select" %>
      </div>
      
      <div class="col-md-3 d-flex align-items-end">
        <%= f.submit "Filtrar", class: "btn btn-primary me-2" %>
        <%= link_to "Limpar", parts_path, class: "btn btn-secondary" %>
      </div>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @parts.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Código</th>
              <th>Nome</th>
              <th>Marca</th>
              <th>Categoria</th>
              <th>Preço Unitário</th>
              <th>Estoque</th>
              <th>Status</th>
              <th>Ações</th>
            </tr>
          </thead>
          <tbody>
            <% @parts.each do |part| %>
              <tr class="<%= 'table-warning' if part.stock_quantity <= part.minimum_stock && part.active %>">
                <td><code><%= part.code || "-" %></code></td>
                <td>
                  <%= link_to part.name, part_path(part) %>
                  <% if part.stock_quantity <= 0 && part.active %>
                    <span class="badge bg-danger ms-2">Sem estoque</span>
                  <% elsif part.stock_quantity <= part.minimum_stock && part.active %>
                    <span class="badge bg-warning ms-2">Estoque baixo</span>
                  <% end %>
                </td>
                <td><%= part.brand || "-" %></td>
                <td><%= part.category || "-" %></td>
                <td><strong class="text-success"><%= part.formatted_unit_price %></strong></td>
                <td>
                  <%= part.stock_quantity %> <%= part.unit %>
                  <% if part.minimum_stock > 0 %>
                    <br><small class="text-muted">Mín: <%= part.minimum_stock %></small>
                  <% end %>
                </td>
                <td>
                  <% if part.active %>
                    <span class="badge bg-success">Ativa</span>
                  <% else %>
                    <span class="badge bg-secondary">Inativa</span>
                  <% end %>
                </td>
                <td>
                  <div class="btn-group btn-group-sm">
                    <%= link_to "Ver", part_path(part), class: "btn btn-info" %>
                    <%= link_to "Editar", edit_part_path(part), class: "btn btn-warning" %>
                    <%= button_to "Excluir", part_path(part), 
                                  method: :delete, 
                                  data: { confirm: "Tem certeza?" },
                                  class: "btn btn-danger" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <p class="text-muted text-center py-4">
        Nenhuma peça encontrada.
        <%= link_to "Cadastrar a primeira", new_part_path, class: "btn btn-primary" %>
      </p>
    <% end %>
  </div>
</div>
