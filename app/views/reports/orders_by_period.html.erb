<div class="container mt-4">
  <h1><i class="fas fa-clipboard-list"></i> Relatório de Ordens por Período</h1>
  
  <div class="card mt-4">
    <div class="card-body">
      <%= form_with url: orders_by_period_reports_path, method: :get, local: true, class: "row g-3" do |f| %>
        <div class="col-md-4">
          <%= f.label :start_date, "Data Inicial", class: "form-label" %>
          <%= f.date_field :start_date, value: @start_date, class: "form-control" %>
        </div>
        <div class="col-md-4">
          <%= f.label :end_date, "Data Final", class: "form-label" %>
          <%= f.date_field :end_date, value: @end_date, class: "form-control" %>
        </div>
        <div class="col-md-4 d-flex align-items-end">
          <%= f.submit "Filtrar", class: "btn btn-primary me-2" %>
          <%= link_to "Exportar Excel", orders_by_period_reports_path(format: :xlsx, start_date: @start_date, end_date: @end_date), class: "btn btn-success" %>
        </div>
      <% end %>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-header">
      <h5>Estatísticas</h5>
    </div>
    <div class="card-body">
      <div class="row">
        <div class="col-md-3">
          <h6>Total:</h6>
          <h3><%= @stats[:total] %></h3>
        </div>
        <div class="col-md-3">
          <h6>Concluídas:</h6>
          <h3 class="text-success"><%= @stats[:completed] %></h3>
        </div>
        <div class="col-md-3">
          <h6>Canceladas:</h6>
          <h3 class="text-danger"><%= @stats[:cancelled] %></h3>
        </div>
        <div class="col-md-3">
          <h6>Tempo Médio:</h6>
          <h3><%= @stats[:average_completion_time] %> dias</h3>
        </div>
      </div>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>ID</th>
              <th>Título</th>
              <th>Cliente</th>
              <th>Status</th>
              <th>Valor</th>
              <th>Data</th>
            </tr>
          </thead>
          <tbody>
            <% @orders.each do |order| %>
              <tr>
                <td><%= order.id %></td>
                <td><%= link_to order.title, service_order_path(order) %></td>
                <td><%= order.customer_name %></td>
                <td><span class="badge <%= order.status_badge_class %>"><%= order.status.humanize %></span></td>
                <td><%= order.formatted_total_value %></td>
                <td><%= l(order.created_at, format: :short) %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
